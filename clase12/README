# clase 12 - Juego de mecanograf√≠a

**Creando un juego usando eventos**

## Programaci√≥n impulsada por eventos

Al crear una aplicaci√≥n basada en navegador, proporcionamos una interfaz gr√°fica de usuario (GUI - Interfaz Gr√°fica de Usuario) para que el usuario la use cuando interact√∫e con lo que hemos creado.¬†La forma m√°s com√∫n de interactuar con el navegador es haciendo clic y escribiendo en varios elementos.¬†El desaf√≠o al que nos enfrentamos como desarrolladores es que no sabemos cu√°ndo van a realizar estas operaciones.

[La programaci√≥n basada en eventos](https://en.wikipedia.org/wiki/Event-driven_programming)¬†es el nombre del tipo de programaci√≥n que necesitamos hacer para crear nuestra GUI.¬†Si desglosamos un poco esta frase, vemos que la palabra central aqu√≠ es¬†**evento**¬†.¬†[Evento](https://www.merriam-webster.com/dictionary/event)¬†, seg√∫n Merriam-Webster, se define como "algo que sucede".¬†Esto describe perfectamente nuestra situaci√≥n.¬†Sabemos que va a pasar algo por lo que queremos ejecutar alg√∫n c√≥digo en respuesta, pero no sabemos cu√°ndo ocurrir√°.

La forma en que marcamos una secci√≥n de c√≥digo que queremos ejecutar es creando una funci√≥n.¬†Cuando pensamos en¬†[la programaci√≥n procedimental](https://en.wikipedia.org/wiki/Procedural_programming)¬†, las funciones se llaman en un orden espec√≠fico.¬†Lo mismo suceder√° con la programaci√≥n basada en eventos.¬†La diferencia es¬†**c√≥mo**¬†se llamar√°n las funciones.

Para manejar eventos (hacer clic en un bot√≥n, escribir, etc.), registramos¬†**detectores de eventos**¬†.¬†Un detector de eventos es una funci√≥n que escucha si ocurre un evento y se ejecuta en respuesta.¬†Los detectores de eventos pueden actualizar la interfaz de usuario, realizar llamadas al servidor o cualquier otra cosa que deba hacerse en respuesta a la acci√≥n del usuario.¬†Agregamos un detector de eventos usando¬†[addEventListener](https://developer.mozilla.org/docs/Web/API/EventTarget/addEventListener)¬†y proporcionando una funci√≥n para ejecutar.

> **NOTA:**¬†Vale la pena resaltar que existen numerosas formas de crear detectores de eventos.¬†Puede usar funciones an√≥nimas o crear funciones con nombre.¬†Puede usar varios accesos directos, como configurar la¬†clickpropiedad o usar¬†addEventListener.¬†En nuestro ejercicio nos vamos a centrar en¬†addEventListener las funciones an√≥nimas, ya que es probablemente la t√©cnica m√°s com√∫n que utilizan los desarrolladores web.¬†Tambi√©n es el m√°s flexible, ya que¬†addEventListener funciona para todos los eventos, y el nombre del evento se puede proporcionar como par√°metro.


Hay¬†[docenas de eventos](https://developer.mozilla.org/docs/Web/Events)¬†disponibles para escuchar al crear una aplicaci√≥n.¬†B√°sicamente, todo lo que hace un usuario en una p√°gina genera un evento, lo que te da mucho poder para garantizar que obtengan la experiencia que deseas.¬†Afortunadamente, normalmente solo necesitar√° un peque√±o pu√±ado de eventos.¬†Aqu√≠ hay algunos comunes (incluidos los dos que usaremos al crear nuestro juego):
- [clic](https://developer.mozilla.org/docs/Web/API/Element/click_event)
    
    : el usuario hizo clic en algo, generalmente un bot√≥n o un hiperv√≠nculo
    
- [men√∫ contextual](https://developer.mozilla.org/docs/Web/API/Element/contextmenu_event)
    
    : el usuario hizo clic con el bot√≥n derecho del mouse
    
- [seleccionar](https://developer.mozilla.org/docs/Web/API/Element/select_event)
    
    : el usuario resalt√≥ alg√∫n texto
    
- [entrada](https://developer.mozilla.org/docs/Web/API/Element/input_event)
    
    : el usuario ingresa un texto

## Creando el juego

Vamos a crear un juego para explorar c√≥mo funcionan los eventos en JavaScript.¬†Nuestro juego pondr√° a prueba la habilidad de escritura de un jugador, que es una de las habilidades m√°s subestimadas que todos los desarrolladores deber√≠an tener.¬†¬°Todos deber√≠amos estar practicando nuestra mecanograf√≠a!¬†El flujo general del juego se ver√° as√≠:

- El jugador hace clic en el bot√≥n de inicio y se le presenta una cita para escribir
- El jugador escribe la cita lo m√°s r√°pido que puede en un cuadro de texto
    - A medida que se completa cada palabra, se resalta la siguiente
    - Si el jugador tiene un error tipogr√°fico, el cuadro de texto se actualiza a rojo
    - Cuando el jugador completa la cotizaci√≥n, se muestra un mensaje de √©xito con el tiempo transcurrido

**¬°Construyamos nuestro juego y aprendamos sobre los eventos!**

## Estructura de archivos

Necesitaremos tres archivos en total: index.html , script.js y style.css . Comencemos por configurarlos para hacernos la vida un poco m√°s f√°cil.

Cree una nueva carpeta para su trabajo abriendo una ventana de consola o terminal y emitiendo el siguiente comando:

```bash
# Linux o macOS
mkdir typing-game && cd typing-game

# Windows
md typing-game && cd typing-game
```
- Para abrir Visual Studio Code

```bash
code .
```

- A√±ade tres archivos:
  - index.html
  - script.js
  - style.css

## Crear la interfaz de usuario

Si exploramos los requisitos, sabemos que necesitaremos algunos elementos en nuestra p√°gina HTML. Esto es algo as√≠ como una receta, donde necesitamos algunos ingredientes:

- En alg√∫n lugar para mostrar lo que el usuario la escriba.
- En alg√∫n lugar para mostrar cualquier mensaje, como un mensaje de √©xito.
- Un cuadro de texto para escribir
- Un bot√≥n de inicio

Cada uno de ellos necesitar√° ID para que podamos trabajar con ellos en nuestro JavaScript. Tambi√©n agregaremos referencias a los archivos CSS y JavaScript que vamos a crear.

Cree un nuevo archivo llamado index.html . Agregue el siguiente HTML:

```html
<!-- inside index.html -->
<html>
<head>
  <title>Typing game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Typing game!</h1>
  <p>Practica tus habilidades de mecanograf√≠a con una cita. ¬°Haga clic en **iniciar** para comenzar!</p>
  <p id="quote"></p> <!--Aqu√≠ se mostrar√° tu cita  -->
  <p id="message"></p> <!-- Esto mostrar√° cualquier mensaje de estado -->
  <div>
    <input type="text" aria-label="current word" id="typed-value" /> <!-- El cuadro de texto para escribir -->
    <button type="button" id="start">Start</button> <!-- Para comenzar el juego -->
  </div>
  <script src="script.js"></script>
</body>
</html>
```

## Iniciar la aplicacion

Siempre es mejor desarrollar de forma iterativa para ver c√≥mo se ven las cosas. Iniciemos nuestra aplicaci√≥n. Existe una maravillosa extensi√≥n para Visual Studio Code llamada `Live Server` que alojar√° su aplicaci√≥n localmente y actualizar√° el navegador cada vez que la guarde.

- Instale Live Server
- Una vez instalado, en Visual Studio Code, haga clic en Ctrl-Shift-P (o Cmd-Shift-P) para abrir la paleta de comandos.
Escriba Live Server: Abrir con Live Server
Live Server comenzar√° a alojar su aplicaci√≥n
Abra un navegador y navegue hasta https://localhost:5500

**¬°Ahora deber√≠as ver la p√°gina que creaste!**

Agreguemos algunas funciones.

## Agrega el CSS

Con nuestro HTML creado, agreguemos el CSS para el estilo principal. Necesitamos resaltar la palabra que el jugador deber√≠a escribir y colorear el cuadro de texto si lo que escribi√≥ es incorrecto. Haremos esto con dos clases.

Cree un nuevo archivo llamado style.css y agregue la siguiente sintaxis.

```css
/* dentro de style.css */
.highlight {
  background-color: yellow;
}

.error {
  background-color: lightcoral;
  border: red;
}
```

‚úÖ Cuando se trata de CSS, puedes dise√±ar tu p√°gina como quieras. T√≥mate un poco de tiempo y haz que la p√°gina parezca m√°s atractiva:

- Elige una fuente diferente
- Colorea los encabezados
- Cambiar el tama√±o de los elementos

## Javascript
Con nuestra interfaz de usuario creada, es hora de centrar nuestra atenci√≥n en JavaScript que proporcionar√° la l√≥gica. Vamos a dividir esto en unos pocos pasos:

- Crea las constantes
- Oyente de eventos para iniciar el juego.
- Oyente de eventos para escribir

Pero primero, cree un nuevo archivo llamado script.js .

## Agrega las constantes
Necesitaremos algunos elementos para hacernos la vida un poco m√°s f√°cil a la hora de programar. Nuevamente, similar a una receta, esto es lo que necesitaremos:

- Array con la lista de todas las citas.
- Array vac√≠o para almacenar todas las palabras de la cotizaci√≥n actual
- Espacio para almacenar el √≠ndice de la palabra que el jugador est√° escribiendo actualmente.
- La hora en que el jugador hizo clic en iniciar

Tambi√©n vamos a querer referencias a los elementos de la interfaz de usuario:

- El cuadro de texto ( **valor escrito** )
- La visualizaci√≥n de citas ( **quote** )
- El mensaje ( **mensaje** )

```javascript
// dentro de script.js
// todas las citas
const quotes = [
    'Hazlo o no lo hagas. Pero no lo intentes.',
    'El mejor profesor, el fracaso es.',
    'Paciencia debes tener, mi joven padawan.',
    'El miedo es el camino hacia el lado oscuro, el miedo lleva a la ira, la ira lleva al odio, el odio lleva al sufrimiento, el sufrimiento al lado oscuro.',
    'Transmite siempre lo que has aprendido.',
    'Dif√≠cil de ver es. Siempre en movimiento el futuro est√°.',
    'Imposible nada es. Dif√≠cil, muchas cosas son.',
];

// Almacenar la lista de palabras y el √≠ndice de la palabra que el jugador est√° escribiendo actualmente
let words = [];
let wordIndex = 0;
// Tiempo de inicio
let startTime = Date.now();
// Elementos de p√°gina
const quoteElement = document.getElementById('quote');
const messageElement = document.getElementById('message');
const typedValueElement = document.getElementById('typed-value');
```

‚úÖ Contin√∫e y agregue m√°s citas a su juego

## Agregar l√≥gica de inicio

Para comenzar el juego, el jugador har√° clic en iniciar. Por supuesto, no sabemos cu√°ndo har√°n clic en iniciar. Aqu√≠ es donde entra en juego un [event listener](https://developer.mozilla.org/docs/Web/API/EventTarget/addEventListener). 
Un detector de eventos nos permitir√° escuchar si ocurre algo (un evento) y ejecutar c√≥digo en respuesta. En nuestro caso, queremos ejecutar c√≥digo cuando el usuario hace clic en iniciar.

Cuando el usuario hace clic en Inicio , debemos seleccionar una cita, configurar la interfaz de usuario y configurar el seguimiento de la palabra y el tiempo actuales. A continuaci√≥n se muestra el JavaScript que deber√° agregar; Lo discutimos justo despu√©s del bloque del gui√≥n.

```javascript
// Al final de script.js
document.getElementById('start').addEventListener('click', () => {
  // Obten una cita
  const quoteIndex = Math.floor(Math.random() * quotes.length);
  const quote = quotes[quoteIndex];
  // Pon la cita en una serie de palabras
  words = quote.split(' ');
  // Restablece el √≠ndice de palabras para el seguimiento
  wordIndex = 0;

  // UI Actualizaciones
  // Crea un array de elementos span para establecer una clase
  const spanWords = words.map(function(word) { return `<span>${word} </span>`});
  // Convierta en string y configurarlo como innerHTML en la visualizaci√≥n de comillas
  quoteElement.innerHTML = spanWords.join('');
  // Resalte la primera palabra
  quoteElement.childNodes[0].className = 'highlight';
  // Borrar cualquier mensaje anterior
  messageElement.innerText = '';

  // Configurar el cuadro de texto
  // Limpiar el cuadro de texto
  typedValueElement.value = '';
  // Enfocar
  typedValueElement.focus();
  // Configurar el controlador de eventos

  // Iniciar el cron√≥metro
  startTime = new Date().getTime();
});
```

- ¬°Desglosemos el c√≥digo!

- Configurar el seguimiento de palabras
Usar Math.floor y Math.random nos permite seleccionar aleatoriamente una cita de la matriz`quotes`.

- Convertimos el `quote`en una matriz de `words`para que podamos rastrear la palabra que el jugador est√° escribiendo actualmente.

- `wordIndex` se establece en 0, ya que el jugador comenzar√° con la primera palabra.

- Configurar la interfaz de usuario
- Crea una matriz de `spanWords`, que contiene cada palabra dentro de un `span` elemento.
Esto nos permitir√° resaltar la palabra en la pantalla.
- La matriz `join`para crear una cadena que podemos usar para actualizar  `innerHTML` el `quoteElement`.
Esto mostrar√° la cotizaci√≥n al jugador.
- Establezca el `className` del primer `span` elemento para `highlight` resaltarlo en amarillo.
- Limpie el `messageElement` configurando `innerText`en `''``
- Configurar el cuadro de texto
- Borrar la corriente `value` en `typedValueElement`
- Establezca el `focus` en `typedValueElement`
- Inicie el cron√≥metro llamando `getTime`.

## Agregar l√≥gica de escritura

A medida que el jugador escriba, `input` se generar√° un evento. Este detector de eventos verificar√° que el jugador est√© escribiendo la palabra correctamente y manejar√° el estado actual del juego. Volviendo a script.js , agregue el siguiente c√≥digo al final. Lo desglosaremos despu√©s.

```javascript
// al final de script.js
typedValueElement.addEventListener('input', () => {
  // Obtener la palabra actual
  const currentWord = words[wordIndex];
  // Obtener el valor actual
  const typedValue = typedValueElement.value;

  if (typedValue === currentWord && wordIndex === words.length - 1) {
    // final de la frase
    // Mostrar √©xito
    const elapsedTime = new Date().getTime() - startTime;
    const message = `CONGRATULATIONS! You finished in ${elapsedTime / 1000} seconds.`;
    messageElement.innerText = message;
  } else if (typedValue.endsWith(' ') && typedValue.trim() === currentWord) {
    // Palabra final
    // Borra el typedValueElement para la nueva palabra
    typedValueElement.value = '';
    // Pasar a la siguiente palabra
    wordIndex++;
    // restablecer el nombre de clase para todos los elementos entre comillas
    for (const wordElement of quoteElement.childNodes) {
      wordElement.className = '';
    }
    // Resaltar la nueva palabra 
    quoteElement.childNodes[wordIndex].className = 'highlight';
  } else if (currentWord.startsWith(typedValue)) {
    // Actualmente correcta
    // Resaltar la siquiente palabra 
    typedValueElement.className = '';
  } else {
    // estado de error
    typedValueElement.className = 'error';
  }
});
```

**¬°Desglosemos el c√≥digo!**

Comenzamos tomando la palabra actual y el valor que el jugador ha escrito hasta el momento. Luego tenemos la l√≥gica en cascada, donde verificamos si la cita est√° completa, la palabra est√° completa, la palabra es correcta o (finalmente), si hay un error.

- La cita est√° completa, indicada por `typedValue` ser igual a `currentWord` y `wordIndex` ser igual a uno menos que el `length` de `words`.
- Calcular `elapsedTime` restando `startTime` de la hora actual.
- Divida `elapsedTime` por 1000 para convertir de milisegundos a segundos.
- Mostrar un mensaje de √©xito.
- La palabra est√° completa, lo que se indica `typedValue` terminando con un espacio (el final de una palabra) y `typedValue` siendo igual `acurrentWord`.
- Establezca `value` en `typedElement` ser `''` para permitir que se escriba la siguiente palabra.
- Incremento `wordIndex` para pasar a la siguiente palabra.
- Recorra todo `childNodes` para `quoteElement` configurar `classNamey` en `''` para volver a la visualizaci√≥n predeterminada.           
- Establezca `className` la palabra actual para `highlight` marcarla como la siguiente palabra a escribir.
- Actualmente, Word est√° escrito correctamente (pero no completo), indicado por que `currentWord` comienza con `typedValue`.
- Aseg√∫rese de que `typedValueElement` se muestre como predeterminado al borrar `className`.
- Si llegamos hasta aqu√≠, tenemos un error.
- Establecer `className` en `typedValueElement` par `error`.

## Pruebe su aplicaci√≥n

¬°Has llegado al final! El √∫ltimo paso es asegurarnos de que nuestra aplicaci√≥n funcione. ¬°Comencemos! No te preocupes si hay errores; Todos los desarrolladores tienen errores. Examine los mensajes y depure seg√∫n sea necesario.

![Animacion](../clase12/TG.gif)

Haga clic en Inicio y comience a escribir. Deber√≠a parecerse un poco a la animaci√≥n que vimos antes.

## üöÄ Desaf√≠o

Agregar m√°s funcionalidad

- Deshabilite el inputdetector de eventos al finalizar y vuelva a habilitarlo cuando se haga clic en el bot√≥n
- Deshabilite el cuadro de texto cuando el jugador complete la cita.
- Mostrar un cuadro de di√°logo modal con el mensaje de √©xito.